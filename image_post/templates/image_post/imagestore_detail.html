{% extends 'user/base.html' %}
{% load static %}
{% block title %}
    Image detail
{% endblock title %}
{% block link %}
    {{block.super}}
    <link rel="stylesheet" type="text/css" href="{% static 'user/css/newcustom.css' %}">
{% endblock link %}
{% block body %}
    {{block.super}}
    <div class="modal fade" id="copyLink" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Image link</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modal-body">
        <p id="txt"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary copy-btn">Copy</button>
      </div>
    </div>
  </div>
</div>
    <div class="container">
        <div class="row mt-3 shadow-lg rounded">
            <div class="col-sm-7 p-2">
                <img width=700px height=700px src="{{ one_data.image_path.url }}">
            </div>
            <div class="col-sm-5 p-2">
                <div class="mb-4">
                    <a class="btn btn-primary" href="{% url 'home' %}">Back</a>
                    <button onclick="download()" class="btn btn-primary">Download</button>
                    {% if save_user_data %}
                    <input type="submit" class="btn btn-primary" id="id_saved" value="Saved" disabled>
                    {% else %}
                        <form action="{% url 'image-detail' one_data.id %}" method="post" class="d-inline">
                            {% csrf_token %}
                            {% for form in forms.hidden_fields %}
                                {{form}}
                            {% endfor %}
                            <input type="submit" onclick="change()" class="btn btn-primary" id="id_save" value="Save">
                        </form>
                    {% endif %}
                    <button type="button" class="btn btn-primary share-btn" data-bs-toggle="modal" data-bs-target="#copyLink">Share</button>
                </div>
                <p>Image category : {{one_data.topic}}</p>
                <p>Uploaded by : {{one_data.user}}</p>
                <p>Upload date : {{one_data.image_upload_date}}</p>
                <div class="row">
                    <div class="col-md-1 gx-1">
                        <img class="rounded-circle" src="{{one_data.user.profile_image.url}}" height="50px" width="50px">
                    </div>
                    <div class="col-md-5">
                        <h5>{{one_data.user}}</h5>
                        <h6 id="followers">{{follower_data}} followers</h6>
                    </div>
                    <div class="col-md-3 follow-div m-auto">
                        {% if one_data.user.id != request.user.id  %}
                            <form>
                                {% csrf_token %}
                                <input type="hidden" value="{{request.user.id}}" id="user_id">
                                <input type="hidden" value="{{one_data.user.id}}" id="id_follow_user">
                                {% if not validate_follow_btn.exists %}
                                    <input type="button" class="btn btn-primary p-2 btn-follow" value="Follow">
                                {% else %}
                                    <input type="button" class="btn btn-primary p-2 btn-unfollow" value="Unfollow">
                                {% endif %}
                            </form>
                        {% endif %}
                    </div>
                </div>
                <div class="row mt-2 like-div">
                    <div class="col-md-3 gy-2">
                        <h4 id="likes">{{total_likes}} likes</h4>
                    </div>
                    <div class="col-md-6">
                        <form>
                            {% csrf_token %}
                            <input type="hidden" value="{{one_data.user.id}}" id="user">
                            <input type="hidden" value="{{request.user.id}}" id="like_user_id">
                            <input type="hidden" value="{{one_data.id}}" id="image_id">
                             {% if not validate_like_btn.exists %}
                                <input type="button" class="btn btn-primary p-2 btn-like ml-3" value="Like">
                            {% else %}
                                <input type="button" class="btn btn-primary p-2 btn-unlike ml-3" value="Unlike">
                            {% endif %}
                        </form>
                    </div>
                </div>
                <h3 class="mt-3">Description:</h3>
                <p>{{one_data.description}}</p>
                <h3 class="mt-3 mb-3">Comments:</h3>
                <div class="row">
                    <div class="container" style="height:100px;overflow:auto;">
                        <div class="row">
                             {% if comment_data.exists %}
                                {% for cmt_data in comment_data %}
                                    <div class="col-md-1">
                                        <img class="rounded-circle" src="{{cmt_data.user.profile_image.url}}" height="40px" width="40px">
                                    </div>
                                    <div class="col-md-9">
                                        <p class="fs-4 bg-info fw-bold text-break border border-info">{{cmt_data.comment}}</p>
                                    </div>
                                    <div class="col-md-2">
                                        {% if cmt_data.user.id == request.user.id %}
                                            <form method="post">
                                                {% csrf_token %}
                                                 <button class="btn btn-danger cmt-delete" comment-data="{{cmt_data.id}}" id="del-comment-btn">del</button>
                                            </form>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                             {% endif %}
                        </div>
                    </div>
                </div>
                <form id="commemtdata" method="post">
                    <div class="row mt-5">
                    {% csrf_token %}
                        <div class="col-md-9 gx-1">
                            <input type="text" class="form-control" placeholder="comment" id="comment" required>
                            <input type="hidden" value="{{request.user.id}}" id="comment_user_id">
                            <input type="hidden" value="{{one_data.id}}" id="comment_image_id">
                        </div>
                        <div class="col-md-1 comment-div">
                            <button class="btn btn-primary add-comment-btn" id="add-comment-btn">add</button>
                            </div>
                         </div>
                        </form>

            </div>
        </div>
    </div>
    <h4 class="text-center m-3 text-bold">More like this</h4>
    <div class="grid m-3" data-masonry='{ "itemSelector": ".grid-item", "isFitWidth": true,"gutter":15}'>
      {% for u_image in all_data %}
      <div class="grid-item grid-item--height2 shadow-lg">
          <a href="{% url 'image-detail' u_image.id %}"><img src="{{u_image.image_path.url}}" class="img-one img-zero"></a>
        </div>
      {% endfor %}
    </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js" integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    function download(){
        axios({
        url: '{{one_data.image_path.url}}',
        method: 'GET',
        responseType: 'blob',
    }).then((response) => {
        const url = window.URL.createObjectURL(new Blob([response.data]));
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', 'image.jpg');
        document.body.appendChild(link);
        link.click();
    });
};
</script>
<script src="{% static 'image_post/js/ajax.js' %}"></script>
<script src="{% static 'image_post/js/custom.js' %}"></script>
{% endblock body %}